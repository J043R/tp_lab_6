# Лаба 6 — Рефакторинг и code smells

Цель: улучшить структуру кода в `order_processing.py` без изменения поведения и сохранить прохождение тестов. :contentReference[oaicite:2]{index=2}

## Что было не так в исходном коде

- Функция `process_checkout` была слишком длинной и делала сразу всё: разбор запроса, валидацию, расчёты и сбор ответа.
- Много «магических чисел» (ставка налога, пороги, проценты скидок) — было сложно быстро понять правила.
- Логика скидок и валидации была смешана с основным сценарием и плохо читалась сверху вниз.
- Повторяющиеся проверки и вычисления усложняли поддержку и расширение.

## Что я сделал(а) при рефакторинге

- Разбил(а) логику на небольшие функции:
  - `parse_request` — разбор входного запроса
  - `normalize_currency` — нормализация валюты
  - `validate_request` / `validate_items` — валидация запроса и позиций
  - `calculate_subtotal` — подсчёт суммы
  - `calculate_discount` — расчёт скидки по купону
  - `calculate_tax` — расчёт налога
  - `generate_order_id` — генерация id заказа
  - `build_response` — сбор итогового ответа
- Вынес(а) значения правил в константы (налог, проценты скидок, пороги).
- Сделал(а) `process_checkout` короткой функцией-сценарием: код читается сверху вниз как последовательность шагов.

## Что стало проще

- Правила скидок и налогов теперь легко менять в одном месте (константы + отдельные функции).
- Проще добавлять новые купоны/правила, не раздувая `process_checkout`.
- Валидация отделена от расчётов, и ошибки искать легче.
- Итоговая логика осталась прежней — тесты должны проходить без изменений. :contentReference[oaicite:3]{index=3}

## Как запустить тесты

```bash
pytest -q
